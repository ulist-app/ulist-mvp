(this["webpackJsonpulist-mvp"]=this["webpackJsonpulist-mvp"]||[]).push([[0],{105:function(e,t,n){},106:function(e,t,n){},107:function(e,t){},122:function(e,t){},124:function(e,t){},137:function(e,t){},139:function(e,t){},145:function(e,t){},153:function(e,t,n){},155:function(e,t,n){},156:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var r=n(4),i=n.n(r),c=n(87),s=n.n(c),a=(n(105),n(12)),o=(n(106),"#62bb47"),u="#fcb827",l="#e03a3c",d="#963d97",b="#ffffff",j="#999999",h="32px",f=n(6),m=n(7),O=n(165),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(O.a)();Object(m.a)(this,e),this.value=void 0,this.value=t}return Object(f.a)(e,[{key:"toString",value:function(){return this.value}}]),e}(),v=Object(f.a)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t._id,r=t._rev,i=t.id,c=t.name,s=t.color;Object(m.a)(this,e),this._id=void 0,this._rev=void 0,this.id=void 0,this.name=void 0,this.color=void 0,this.id=i||new y,this._id=n||this.id.value,this._rev=r,this.name=c||"No Category",this.color=s||j})),p=new v({id:new y("default-category")}),g=Object(f.a)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t._id,r=t._rev,i=t.id,c=t.name,s=t.category,a=t.isRequired,o=t.isMandatory,u=t.quantity;Object(m.a)(this,e),this._id=void 0,this._rev=void 0,this.id=void 0,this.category=void 0,this.name=void 0,this.isRequired=void 0,this.isMandatory=void 0,this.quantity=void 0,this.id=i||new y,this._id=n||this.id.value,this._rev=r,this.name=c||"Untitled",this.category=s||p,this.isRequired=null!==a&&void 0!==a&&a,this.isMandatory=null!==o&&void 0!==o&&o,this.quantity=null!==u&&void 0!==u?u:1})),x=n(25),I=function(){function e(t){Object(m.a)(this,e),this._items=void 0,this._items=t}return Object(f.a)(e,[{key:"getAll",value:function(){return this.items}},{key:"getAllRequired",value:function(){return this.items.filter((function(e){return e.isRequired}))}},{key:"getAllMandatory",value:function(){return this.items.filter((function(e){return e.isMandatory&&e.isRequired}))}},{key:"search",value:function(t){return new e(this.items.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())})))}},{key:"items",get:function(){return Object(x.a)(this._items)}}],[{key:"groupItemsByCategory",value:function(e){return Object.entries(e.reduce((function(e,t){return e[t.category.name]?e[t.category.name]=e[t.category.name].concat(t):e[t.category.name]=[t],e}),{}))}}]),e}(),A=n(44),w=n(47),R=n(48),k="ITEM_NOT_SAVED",C="ITEM_NOT_FOUND",S=function(e){Object(A.a)(n,e);var t=Object(w.a)(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,"Error saving item with id ".concat(e.id.value,"."))).name="ItemNotSavedError",r}return Object(f.a)(n)}(Object(R.a)(Error));S.code=k;var N=n(56),T=function(){function e(t){Object(m.a)(this,e),this.itemsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){return this.itemsRepository.findAll()}}]),e}(),M=function(){function e(t){Object(m.a)(this,e),this.settingsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){return this.settingsRepository.findAll()}}]),e}(),q=n(8),D=n(9),_=n(14),E=function(){function e(t){Object(m.a)(this,e),this.itemsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){var n;return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemsRepository.findById(t);case 2:return n=e.sent,e.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isRequired:!0}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),L=function(){function e(t){Object(m.a)(this,e),this.itemsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){var n;return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemsRepository.findById(t);case 2:return n=e.sent,e.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isRequired:!1,isMandatory:!1}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),B=function(){function e(t){Object(m.a)(this,e),this.itemsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){var n;return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemsRepository.findById(t);case 2:return n=e.sent,e.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isMandatory:!0,isRequired:!0}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),U=function(){function e(t){Object(m.a)(this,e),this.itemsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){var n;return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemsRepository.findById(t);case 2:return n=e.sent,e.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isMandatory:!1}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=function(){function e(t){Object(m.a)(this,e),this.settingsRepository=t}return Object(f.a)(e,[{key:"exec",value:function(e){return this.settingsRepository.save(e)}}]),e}();function P(e){var t=e.itemRepository,n=e.settingsRepository;return{getAllItems:new T(t),getSettings:new M(n),setItemAsMandatory:new B(t),setItemAsNotMandatory:new U(t),setItemAsNotRequired:new L(t),setItemAsRequired:new E(t),setSettings:new F(n)}}var V=n(36),z=n(96),J=n(97);V.a.plugin(z.a),V.a.plugin(J.a);var Y=function(){function e(t){Object(m.a)(this,e),this.db=t}return Object(f.a)(e,null,[{key:"createPouchDbBrowser",value:function(t){return e.createPouchDb(Object(D.a)({},t))}},{key:"createPouchDbMemory",value:function(t){return e.createPouchDb(Object(D.a)(Object(D.a)({},t),{},{options:{adapter:"memory"}}))}},{key:"isPouchDbError",value:function(e){return"status"in e}},{key:"createPouchDb",value:function(t){var n=t.dbName,r=t.dbUrl,i=t.cb,c=t.options,s="".concat(r,"/").concat(n);return r&&i&&V.a.sync(n,s,{live:!0,retry:!0}).on("error",(function(e){console.error("[SYNC ERROR]",e.toString())})).on("active",(function(){console.debug("[SYNC ACTIVE]")})).on("change",(function(e){console.debug("[SYNC CHANGES]",JSON.stringify(e,null,2)),i()})).on("complete",(function(e){console.debug("[SYNC COMPLETE]",JSON.stringify(e,null,2)),i()})),new e(c?new V.a(n,c):new V.a(n))}}]),e}();Y.DocumentTypes={Item:"item",Category:"category"},Y.dbName="groceries";var G=function(e){Object(A.a)(n,e);var t=Object(w.a)(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,"Item with id ".concat(e.value," not found."))).name="ItemNotFoundError",r}return Object(f.a)(n)}(Object(R.a)(Error));G.code=C;var H,$=function(){function e(t){Object(m.a)(this,e),this.pouch=t}return Object(f.a)(e,[{key:"findById",value:function(){var t=Object(_.a)(Object(q.a)().mark((function t(n){var r,i;return Object(q.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.pouch.db.get(n.value);case 3:return r=t.sent,t.next=6,this.findCategory(r.category);case 6:return i=t.sent,t.abrupt("return",e.mapItemToDomain(r,i));case 10:throw t.prev=10,t.t0=t.catch(0),console.error(null===t.t0||void 0===t.t0?void 0:t.t0.toString()),new G(n);case 14:case"end":return t.stop()}}),t,this,[[0,10]])})));return function(e){return t.apply(this,arguments)}}()},{key:"findAll",value:function(){var t=Object(_.a)(Object(q.a)().mark((function t(){var n,r,i,c,s;return Object(q.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.debug("[FIND ALL ITEMS]"),t.next=3,this.pouch.db.allDocs({include_docs:!0});case 3:if(0!==(n=t.sent).total_rows){t.next=6;break}return t.abrupt("return",new I([]));case 6:return r=this.groupDocumentsByType(n),i=r.categories,c=r.items,s=e.generateCategoryDictionary(i),console.debug("[FIND ALL ITEMS]",c),t.abrupt("return",new I(c.map((function(t){var n=s[t.id.value];return e.mapItemToDomain(t,n)}))));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[SAVE ITEM]"),e.next=3,this.pouch.db.put(Object(D.a)(Object(D.a)({},t),{},{id:t.id.value,type:Y.DocumentTypes.Item,category:t.category.id.value}));case 3:if(e.sent.ok){e.next=6;break}throw new S(t);case 6:return e.abrupt("return",this.findById(t.id));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"groupDocumentsByType",value:function(e){var t=e.rows.reduce((function(e,t){var n=t.doc;return n.type===Y.DocumentTypes.Category&&(e.categories=e.categories.concat(n)),n.type===Y.DocumentTypes.Item&&(e.items=e.items.concat(n)),e}),{categories:[],items:[]});return{categories:t.categories,items:t.items}}},{key:"findCategory",value:function(){var t=Object(_.a)(Object(q.a)().mark((function t(n){var r;return Object(q.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pouch.db.get(n);case 2:return r=t.sent,t.abrupt("return",e.mapCategoryToDomain(r));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"mapItemToDomain",value:function(e,t){return new g({_id:e._id,_rev:e._rev,id:new y(e.id),name:e.name,category:t,isRequired:e.isRequired,isMandatory:e.isMandatory})}},{key:"mapCategoryToDomain",value:function(e){return new v({_id:e._id,_rev:e._rev,id:new y(e.id),name:e.name,color:e.color})}},{key:"generateCategoryDictionary",value:function(t){return t.reduce((function(t,n){return t[n.id.value]=e.mapCategoryToDomain(n),t}),{})}}]),e}();!function(e){e.Items="groceries:items",e.Settings="groceries:settings"}(H||(H={}));var K=function(){function e(t){Object(m.a)(this,e),this.collection=t}return Object(f.a)(e,[{key:"get",value:function(){var e=localStorage.getItem(this.collection),t=new RegExp(/^\d+$/),n=new RegExp(/[[{].*[}\]]/);return e?n.test(e)?JSON.parse(e):t.test(e)?parseFloat(e):"true"===e||"false"!==e&&e:null}},{key:"set",value:function(e){"object"===typeof e?localStorage.setItem(this.collection,JSON.stringify(e)):localStorage.setItem(this.collection,e)}}]),e}(),Q=function(){function e(t){Object(m.a)(this,e),this.localStorage=t}return Object(f.a)(e,[{key:"findAll",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(){var t;return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.localStorage.get(),e.abrupt("return",t||{syncUrl:void 0});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(_.a)(Object(q.a)().mark((function e(t){return Object(q.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.localStorage.set(t),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),W=Object(N.proxy)({items:new I([]),settings:{syncUrl:void 0},actions:{getAllItems:function(){},getSettings:function(){},setItemAsRequired:function(){},setItemAsNotRequired:function(){},setItemAsMandatory:function(){},setItemAsNotMandatory:function(){},setSettings:function(){}}});function X(e,t){return P({itemRepository:new $(Y.createPouchDbBrowser({dbName:Y.dbName,dbUrl:e.syncUrl,cb:t})),settingsRepository:new Q(new K(H.Settings))})}function Z(){return P({itemRepository:new $(Y.createPouchDbBrowser({dbName:Y.dbName})),settingsRepository:new Q(new K(H.Settings))})}function ee(e){return{getAllItems:function(){e.getAllItems.exec().then((function(e){W.items=e}))},getSettings:function(){e.getSettings.exec().then((function(e){W.settings=e}))},setItemAsRequired:function(t){e.setItemAsRequired.exec(t).then((function(){return W.actions.getAllItems()}))},setItemAsNotRequired:function(t){e.setItemAsNotRequired.exec(t).then((function(){return W.actions.getAllItems()}))},setItemAsMandatory:function(t){e.setItemAsMandatory.exec(t).then((function(){return W.actions.getAllItems()}))},setItemAsNotMandatory:function(t){e.setItemAsNotMandatory.exec(t).then((function(){return W.actions.getAllItems()}))},setSettings:function(t){e.setSettings.exec(t).then((function(e){W.settings=e,te()}))}}}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z();W.items=new I([]),e.getSettings.exec().then((function(t){t.syncUrl?(console.log("[INIT STORE]: REMOTE DB"),W.actions=ee(X(t,W.actions.getAllItems))):(console.log("[INIT STORE]: LOCAL DB"),W.actions=ee(e))}))}function ne(){return Object(N.useSnapshot)(W)}n(153);var re,ie=n(23),ce=n(57),se={requiredListCTA:"Show items to buy",mandatoryListCTA:"Show mandatory items to buy",allItemsListCTA:"Show all items",searchCTA:"Search items"},ae={setItemAsRequired:"Set item to buy",setItemAsNotRequired:"Remove item from buy list",setItemAsMandatory:"Set item as mandatory to buy",setItemAsNotMandatory:"Remove item from mandatory to buy list"},oe="There are no items in this list",ue={searchInput:"\ud83d\udd0d Search",resetCTA:"Reset your search",closeCTA:"Close search"},le=n(18),de=n(1),be=function(e){var t=e.item,n=ne().actions;return Object(de.jsxs)("div",{className:"ListItem","data-testid":t.id.value,children:[Object(de.jsx)("span",{className:"quantity",children:t.quantity}),Object(de.jsx)(le.a,{to:"/items/".concat(t.id.value),children:Object(de.jsx)("span",{className:"item",children:t.name})}),Object(de.jsx)("span",{className:"is-required",children:t.isRequired?Object(de.jsx)("button",{"aria-label":ae.setItemAsNotRequired,onClick:function(){return n.setItemAsNotRequired(t.id)},children:Object(de.jsx)(ce.a,{size:32,color:l})}):Object(de.jsx)("button",{"aria-label":ae.setItemAsRequired,onClick:function(){return n.setItemAsRequired(t.id)},children:Object(de.jsx)(ce.b,{size:32,color:o})})}),Object(de.jsx)("span",{className:"is-mandatory",children:t.isMandatory?Object(de.jsx)("button",{"aria-label":ae.setItemAsNotMandatory,onClick:function(){return n.setItemAsNotMandatory(t.id)},children:Object(de.jsx)(ie.c,{size:32,color:u})}):Object(de.jsx)("button",{"aria-label":ae.setItemAsMandatory,onClick:function(){return n.setItemAsMandatory(t.id)},children:Object(de.jsx)(ie.c,{size:32,color:j})})})]})},je=(n(155),function(){return Object(de.jsx)("div",{className:"List",children:Object(de.jsx)("p",{children:oe})})}),he=function(e){var t=e.items;return 0===t.length?Object(de.jsx)(je,{}):Object(de.jsx)("div",{className:"List",children:I.groupItemsByCategory(t).map((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(de.jsxs)("details",{open:!0,children:[Object(de.jsx)("summary",{children:n}),Object(de.jsx)("ul",{className:"ItemList",children:r.map((function(e){return Object(de.jsx)("li",{children:Object(de.jsx)(be,{item:e})},e.id.value)}))})]},n)}))})},fe=(n(156),n(95)),me=(n(157),n(94)),Oe=function(e){var t=e.onChange,n=e.onClose,i=Object(r.useState)(""),c=Object(a.a)(i,2),s=c[0],o=c[1];function u(e){o(e),t(e)}return Object(de.jsxs)("div",{className:"Search",children:[Object(de.jsx)("input",{"aria-label":ue.searchInput,type:"text",value:s,onChange:function(e){u(e.currentTarget.value.trim())},placeholder:ue.searchInput}),Object(de.jsxs)("button",{"aria-label":s?ue.resetCTA:ue.closeCTA,onClick:function(){s?u(""):n()},children:[s&&Object(de.jsx)(ie.a,{size:h}),!s&&Object(de.jsx)(me.a,{size:h})]})]})},ye=n(49),ve=n.n(ye);!function(e){e[e.All=0]="All",e[e.Required=1]="Required",e[e.Mandatory=2]="Mandatory"}(re||(re={}));var pe=function(e){var t=e.setView,n=e.activeView,i=e.onSearch,c=Object(r.useState)(!1),s=Object(a.a)(c,2),o=s[0],l=s[1],j=Object(r.useCallback)((function(){return l(!1)}),[l]),h=function(e){return e===n},f=function(e){return h(e)?u:"transparent"},m=function(e){return h(e)?d:"inherit"};return Object(de.jsx)("nav",{className:"Menu",children:Object(de.jsx)("div",{className:ve()("flip-container",{active:o}),children:o?Object(de.jsx)("div",{className:ve()("flip-back",{active:o}),children:Object(de.jsx)(Oe,{onChange:i,onClose:j})}):Object(de.jsxs)("ul",{style:{backgroundColor:d,color:b},className:ve()("flip-front",{active:!o}),children:[Object(de.jsx)("li",{style:{backgroundColor:f(re.All),color:m(re.All)},children:Object(de.jsx)("button",{"aria-label":se.allItemsListCTA,onClick:function(){return t(re.All)},children:Object(de.jsx)(fe.a,{})})}),Object(de.jsx)("li",{style:{backgroundColor:f(re.Required),color:m(re.Required)},children:Object(de.jsx)("button",{"aria-label":se.requiredListCTA,onClick:function(){return t(re.Required)},children:Object(de.jsx)(ie.b,{})})}),Object(de.jsx)("li",{style:{backgroundColor:f(re.Mandatory),color:m(re.Mandatory)},children:Object(de.jsx)("button",{"aria-label":se.mandatoryListCTA,onClick:function(){return t(re.Mandatory)},children:Object(de.jsx)(ie.c,{})})}),Object(de.jsx)("li",{children:Object(de.jsx)("button",{"aria-label":se.searchCTA,onClick:function(){return l(!0)},children:Object(de.jsx)(ie.d,{})})})]})})})};function ge(){var e=ne(),t=e.items,n=e.actions,i=Object(r.useState)(""),c=Object(a.a)(i,2),s=c[0],o=c[1],u=Object(r.useState)(re.All),l=Object(a.a)(u,2),d=l[0],b=l[1];return Object(r.useEffect)((function(){n.getAllItems()}),[n,d]),Object(de.jsxs)(de.Fragment,{children:[d===re.All&&Object(de.jsx)(he,{items:t.search(s).getAll()}),d===re.Required&&Object(de.jsx)(he,{items:t.search(s).getAllRequired()}),d===re.Mandatory&&Object(de.jsx)(he,{items:t.search(s).getAllMandatory()}),Object(de.jsx)(pe,{activeView:d,setView:b,onSearch:o})]})}var xe=n(164);function Ie(){var e=Object(le.d)("/items/:id"),t=Object(a.a)(e,2),n=t[0],r=t[1];return Object(de.jsx)(xe.a,{in:n,timeout:500,children:Object(de.jsxs)("div",{children:["Hi, this is: ",r.id]})})}function Ae(){var e=Object(le.d)("/settings"),t=Object(a.a)(e,1)[0],n=ne(),i=n.settings,c=n.actions;return Object(r.useEffect)((function(){c.getSettings()}),[c]),Object(de.jsx)(xe.a,{in:t,timeout:500,children:Object(de.jsxs)("form",{onSubmit:function(e){var t;e.preventDefault();var n=null===(t=new FormData(e.currentTarget).get("syncUrl"))||void 0===t?void 0:t.toString();n&&n.length&&c.setSettings({syncUrl:n})},children:[Object(de.jsx)("input",{name:"syncUrl",type:"text",defaultValue:i.syncUrl}),Object(de.jsx)("button",{type:"submit",children:"\ud83d\udcbe"})]})})}var we=function(){var e=Object(le.d)("/"),t=Object(a.a)(e,1)[0];return Object(r.useEffect)((function(){te()}),[]),Object(de.jsx)(le.c,{base:"/ulist-mvp",children:Object(de.jsxs)("div",{className:"App",children:[Object(de.jsxs)("header",{className:"App-header",style:{backgroundColor:d,color:b},children:[Object(de.jsx)("span",{children:!t&&Object(de.jsx)(le.a,{to:"/",children:"\ud83d\udd19"})}),Object(de.jsx)("span",{children:"\ud83d\uded2 Groceries list \ud83d\uded2"}),Object(de.jsx)("span",{children:Object(de.jsx)(le.a,{to:"/settings",children:"\u2699\ufe0f"})})]}),Object(de.jsxs)("main",{className:"App-main",children:[Object(de.jsx)(le.b,{path:"/",component:ge}),Object(de.jsx)(le.b,{path:"/settings",component:Ae}),Object(de.jsx)(le.b,{path:"/items/:id",component:Ie})]})]})})},Re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,166)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),i(e),c(e),s(e)}))};s.a.createRoot(document.getElementById("root")).render(Object(de.jsx)(i.a.StrictMode,{children:Object(de.jsx)(we,{})})),Re()}},[[158,1,2]]]);
//# sourceMappingURL=main.f39f01c1.chunk.js.map