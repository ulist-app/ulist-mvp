(this["webpackJsonpulist-mvp"]=this["webpackJsonpulist-mvp"]||[]).push([[0],{105:function(t,e,n){},106:function(t,e,n){},107:function(t,e){},122:function(t,e){},124:function(t,e){},137:function(t,e){},139:function(t,e){},145:function(t,e){},153:function(t,e,n){},155:function(t,e,n){},156:function(t,e,n){},157:function(t,e,n){},158:function(t,e,n){"use strict";n.r(e);var r=n(4),i=n.n(r),c=n(87),s=n.n(c),a=(n(105),n(12)),o=(n(106),"#62bb47"),u="#fcb827",l="#e03a3c",d="#963d97",b="#ffffff",j="#999999",h="32px",f=n(6),m=n(7),O=n(165),y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(O.a)();Object(m.a)(this,t),this.value=void 0,this.value=e}return Object(f.a)(t,[{key:"toString",value:function(){return this.value}}]),t}(),v=Object(f.a)((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e._id,r=e._rev,i=e.id,c=e.name,s=e.color;Object(m.a)(this,t),this._id=void 0,this._rev=void 0,this.id=void 0,this.name=void 0,this.color=void 0,this.id=i||new y,this._id=n||this.id.value,this._rev=r,this.name=c||"No Category",this.color=s||j})),p=new v({id:new y("default-category")}),g=Object(f.a)((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e._id,r=e._rev,i=e.id,c=e.name,s=e.category,a=e.isRequired,o=e.isMandatory,u=e.quantity;Object(m.a)(this,t),this._id=void 0,this._rev=void 0,this.id=void 0,this.category=void 0,this.name=void 0,this.isRequired=void 0,this.isMandatory=void 0,this.quantity=void 0,this.id=i||new y,this._id=n||this.id.value,this._rev=r,this.name=c||"Untitled",this.category=s||p,this.isRequired=null!==a&&void 0!==a&&a,this.isMandatory=null!==o&&void 0!==o&&o,this.quantity=null!==u&&void 0!==u?u:1})),x=n(25),I=function(){function t(e){Object(m.a)(this,t),this._items=void 0,this._items=e}return Object(f.a)(t,[{key:"items",get:function(){return Object(x.a)(this._items)}},{key:"getAll",value:function(){return this.items}},{key:"getAllRequired",value:function(){return this.items.filter((function(t){return t.isRequired}))}},{key:"getAllMandatory",value:function(){return this.items.filter((function(t){return t.isMandatory&&t.isRequired}))}},{key:"search",value:function(e){return new t(this.items.filter((function(t){return t.name.toLowerCase().includes(e.toLowerCase())})))}}],[{key:"groupItemsByCategory",value:function(t){return Object.entries(t.reduce((function(t,e){return t[e.category.name]?t[e.category.name]=t[e.category.name].concat(e):t[e.category.name]=[e],t}),{}))}}]),t}(),A=n(44),w=n(47),R=n(48),k="ITEM_NOT_SAVED",C="ITEM_NOT_FOUND",S=function(t){Object(A.a)(n,t);var e=Object(w.a)(n);function n(t){var r;return Object(m.a)(this,n),(r=e.call(this,"Error saving item with id ".concat(t.id.value,"."))).name="ItemNotSavedError",r}return Object(f.a)(n)}(Object(R.a)(Error));S.code=k;var N=n(56),q=function(){function t(e){Object(m.a)(this,t),this.itemsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){return this.itemsRepository.findAll()}}]),t}(),T=function(){function t(e){Object(m.a)(this,t),this.settingsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){return this.settingsRepository.findAll()}}]),t}(),M=n(8),D=n(9),_=n(14),E=function(){function t(e){Object(m.a)(this,t),this.itemsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){var n;return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.itemsRepository.findById(e);case 2:return n=t.sent,t.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isRequired:!0}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),L=function(){function t(e){Object(m.a)(this,t),this.itemsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){var n;return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.itemsRepository.findById(e);case 2:return n=t.sent,t.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isRequired:!1,isMandatory:!1}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),B=function(){function t(e){Object(m.a)(this,t),this.itemsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){var n;return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.itemsRepository.findById(e);case 2:return n=t.sent,t.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isMandatory:!0,isRequired:!0}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),U=function(){function t(e){Object(m.a)(this,t),this.itemsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){var n;return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.itemsRepository.findById(e);case 2:return n=t.sent,t.next=5,this.itemsRepository.save(Object(D.a)(Object(D.a)({},n),{},{isMandatory:!1}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),P=function(){function t(e){Object(m.a)(this,t),this.settingsRepository=e}return Object(f.a)(t,[{key:"exec",value:function(t){return this.settingsRepository.save(t)}}]),t}();function F(t){var e=t.itemRepository,n=t.settingsRepository;return{getAllItems:new q(e),getSettings:new T(n),setItemAsMandatory:new B(e),setItemAsNotMandatory:new U(e),setItemAsNotRequired:new L(e),setItemAsRequired:new E(e),setSettings:new P(n)}}var V=n(36),z=n(96),J=n(97);V.a.plugin(z.a),V.a.plugin(J.a);var Y=function(){function t(e){Object(m.a)(this,t),this.db=e}return Object(f.a)(t,null,[{key:"createPouchDbBrowser",value:function(e){return t.createPouchDb(Object(D.a)({},e))}},{key:"createPouchDbMemory",value:function(e){return t.createPouchDb(Object(D.a)(Object(D.a)({},e),{},{options:{adapter:"memory"}}))}},{key:"isPouchDbError",value:function(t){return"status"in t}},{key:"createPouchDb",value:function(e){var n=e.dbName,r=e.dbUrl,i=e.cb,c=e.options,s="".concat(r,"/").concat(n);return r&&i&&V.a.sync(n,s,{live:!0,retry:!0}).on("error",(function(t){console.error("[SYNC ERROR]",t.toString())})).on("active",(function(){console.debug("[SYNC ACTIVE]")})).on("change",(function(t){console.debug("[SYNC CHANGES]",JSON.stringify(t,null,2)),i()})).on("complete",(function(t){console.debug("[SYNC COMPLETE]",JSON.stringify(t,null,2)),i()})),new t(c?new V.a(n,c):new V.a(n))}}]),t}();Y.DocumentTypes={Item:"item",Category:"category"},Y.dbName="groceries";var G=function(t){Object(A.a)(n,t);var e=Object(w.a)(n);function n(t){var r;return Object(m.a)(this,n),(r=e.call(this,"Item with id ".concat(t.value," not found."))).name="ItemNotFoundError",r}return Object(f.a)(n)}(Object(R.a)(Error));G.code=C;var H,$=function(){function t(e){Object(m.a)(this,t),this.pouch=e}return Object(f.a)(t,[{key:"findById",value:function(){var e=Object(_.a)(Object(M.a)().mark((function e(n){var r,i;return Object(M.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.pouch.db.get(n.value);case 3:return r=e.sent,e.next=6,this.findCategory(r.category);case 6:return i=e.sent,e.abrupt("return",t.mapItemToDomain(r,i));case 10:throw e.prev=10,e.t0=e.catch(0),console.error(null===e.t0||void 0===e.t0?void 0:e.t0.toString()),new G(n);case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"findAll",value:function(){var e=Object(_.a)(Object(M.a)().mark((function e(){var n,r,i,c,s;return Object(M.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[FIND ALL ITEMS]"),e.next=3,this.pouch.db.allDocs({include_docs:!0});case 3:if(0!==(n=e.sent).total_rows){e.next=6;break}return e.abrupt("return",new I([]));case 6:return r=this.groupDocumentsByType(n),i=r.categories,c=r.items,s=t.generateCategoryDictionary(i),console.debug("cateog",s,i),e.abrupt("return",new I(c.map((function(e){var n=s[e.category];return t.mapItemToDomain(e,n)}))));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pouch.db.put(Object(D.a)(Object(D.a)({},e),{},{id:e.id.value,type:Y.DocumentTypes.Item,category:e.category.id.value}));case 2:if(t.sent.ok){t.next=5;break}throw new S(e);case 5:return t.abrupt("return",this.findById(e.id));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"groupDocumentsByType",value:function(t){var e=t.rows.reduce((function(t,e){var n=e.doc;return n.type===Y.DocumentTypes.Category&&(t.categories=t.categories.concat(n)),n.type===Y.DocumentTypes.Item&&(t.items=t.items.concat(n)),t}),{categories:[],items:[]});return{categories:e.categories,items:e.items}}},{key:"findCategory",value:function(){var e=Object(_.a)(Object(M.a)().mark((function e(n){var r;return Object(M.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pouch.db.get(n);case 2:return r=e.sent,e.abrupt("return",t.mapCategoryToDomain(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"mapItemToDomain",value:function(t,e){return new g({_id:t._id,_rev:t._rev,id:new y(t.id),name:t.name,category:e,isRequired:t.isRequired,isMandatory:t.isMandatory})}},{key:"mapCategoryToDomain",value:function(t){return new v({_id:t._id,_rev:t._rev,id:new y(t.id),name:t.name,color:t.color})}},{key:"generateCategoryDictionary",value:function(e){return e.reduce((function(e,n){return e[n.id]=t.mapCategoryToDomain(n),e}),{})}}]),t}();!function(t){t.Items="groceries:items",t.Settings="groceries:settings"}(H||(H={}));var K=function(){function t(e){Object(m.a)(this,t),this.collection=e}return Object(f.a)(t,[{key:"get",value:function(){var t=localStorage.getItem(this.collection),e=new RegExp(/^\d+$/),n=new RegExp(/[[{].*[}\]]/);return t?n.test(t)?JSON.parse(t):e.test(t)?parseFloat(t):"true"===t||"false"!==t&&t:null}},{key:"set",value:function(t){"object"===typeof t?localStorage.setItem(this.collection,JSON.stringify(t)):localStorage.setItem(this.collection,t)}}]),t}(),Q=function(){function t(e){Object(m.a)(this,t),this.localStorage=e}return Object(f.a)(t,[{key:"findAll",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(){var e;return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.localStorage.get(),t.abrupt("return",e||{syncUrl:void 0});case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"save",value:function(){var t=Object(_.a)(Object(M.a)().mark((function t(e){return Object(M.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.localStorage.set(e),t.abrupt("return",e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),W=Object(N.proxy)({items:new I([]),settings:{syncUrl:void 0},actions:{getAllItems:function(){},getSettings:function(){},setItemAsRequired:function(){},setItemAsNotRequired:function(){},setItemAsMandatory:function(){},setItemAsNotMandatory:function(){},setSettings:function(){}}});function X(t,e){return F({itemRepository:new $(Y.createPouchDbBrowser({dbName:Y.dbName,dbUrl:t.syncUrl,cb:e})),settingsRepository:new Q(new K(H.Settings))})}function Z(){return F({itemRepository:new $(Y.createPouchDbBrowser({dbName:Y.dbName})),settingsRepository:new Q(new K(H.Settings))})}function tt(t){return{getAllItems:function(){t.getAllItems.exec().then((function(t){W.items=t}))},getSettings:function(){t.getSettings.exec().then((function(t){W.settings=t}))},setItemAsRequired:function(e){t.setItemAsRequired.exec(e).then((function(){return W.actions.getAllItems()}))},setItemAsNotRequired:function(e){t.setItemAsNotRequired.exec(e).then((function(){return W.actions.getAllItems()}))},setItemAsMandatory:function(e){t.setItemAsMandatory.exec(e).then((function(){return W.actions.getAllItems()}))},setItemAsNotMandatory:function(e){t.setItemAsNotMandatory.exec(e).then((function(){return W.actions.getAllItems()}))},setSettings:function(e){t.setSettings.exec(e).then((function(t){W.settings=t,et()}))}}}function et(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z();W.items=new I([]),t.getSettings.exec().then((function(e){e.syncUrl?(console.log("[INIT STORE]: REMOTE DB"),W.actions=tt(X(e,W.actions.getAllItems))):(console.log("[INIT STORE]: LOCAL DB"),W.actions=tt(t))}))}function nt(){return Object(N.useSnapshot)(W)}n(153);var rt,it=n(23),ct=n(57),st={requiredListCTA:"Show items to buy",mandatoryListCTA:"Show mandatory items to buy",allItemsListCTA:"Show all items",searchCTA:"Search items"},at={setItemAsRequired:"Set item to buy",setItemAsNotRequired:"Remove item from buy list",setItemAsMandatory:"Set item as mandatory to buy",setItemAsNotMandatory:"Remove item from mandatory to buy list"},ot="There are no items in this list",ut={searchInput:"\ud83d\udd0d Search",resetCTA:"Reset your search",closeCTA:"Close search"},lt=n(18),dt=n(1),bt=function(t){var e=t.item,n=nt().actions;return Object(dt.jsxs)("div",{className:"ListItem","data-testid":e.id.value,children:[Object(dt.jsx)("span",{className:"quantity",children:e.quantity}),Object(dt.jsx)(lt.a,{to:"/items/".concat(e.id.value),children:Object(dt.jsx)("span",{className:"item",children:e.name})}),Object(dt.jsx)("span",{className:"is-required",children:e.isRequired?Object(dt.jsx)("button",{"aria-label":at.setItemAsNotRequired,onClick:function(){return n.setItemAsNotRequired(e.id)},children:Object(dt.jsx)(ct.a,{size:32,color:l})}):Object(dt.jsx)("button",{"aria-label":at.setItemAsRequired,onClick:function(){return n.setItemAsRequired(e.id)},children:Object(dt.jsx)(ct.b,{size:32,color:o})})}),Object(dt.jsx)("span",{className:"is-mandatory",children:e.isMandatory?Object(dt.jsx)("button",{"aria-label":at.setItemAsNotMandatory,onClick:function(){return n.setItemAsNotMandatory(e.id)},children:Object(dt.jsx)(it.c,{size:32,color:u})}):Object(dt.jsx)("button",{"aria-label":at.setItemAsMandatory,onClick:function(){return n.setItemAsMandatory(e.id)},children:Object(dt.jsx)(it.c,{size:32,color:j})})})]})},jt=(n(155),function(){return Object(dt.jsx)("div",{className:"List",children:Object(dt.jsx)("p",{children:ot})})}),ht=function(t){var e=t.items;return 0===e.length?Object(dt.jsx)(jt,{}):Object(dt.jsx)("div",{className:"List",children:I.groupItemsByCategory(e).map((function(t){var e=Object(a.a)(t,2),n=e[0],r=e[1];return Object(dt.jsxs)("details",{open:!0,children:[Object(dt.jsx)("summary",{children:n}),Object(dt.jsx)("ul",{className:"ItemList",children:r.map((function(t){return Object(dt.jsx)("li",{children:Object(dt.jsx)(bt,{item:t})},t.id.value)}))})]},n)}))})},ft=(n(156),n(95)),mt=(n(157),n(94)),Ot=function(t){var e=t.onChange,n=t.onClose,i=Object(r.useState)(""),c=Object(a.a)(i,2),s=c[0],o=c[1];function u(t){o(t),e(t)}return Object(dt.jsxs)("div",{className:"Search",children:[Object(dt.jsx)("input",{"aria-label":ut.searchInput,type:"text",value:s,onChange:function(t){u(t.currentTarget.value.trim())},placeholder:ut.searchInput}),Object(dt.jsxs)("button",{"aria-label":s?ut.resetCTA:ut.closeCTA,onClick:function(){s?u(""):n()},children:[s&&Object(dt.jsx)(it.a,{size:h}),!s&&Object(dt.jsx)(mt.a,{size:h})]})]})},yt=n(49),vt=n.n(yt);!function(t){t[t.All=0]="All",t[t.Required=1]="Required",t[t.Mandatory=2]="Mandatory"}(rt||(rt={}));var pt=function(t){var e=t.setView,n=t.activeView,i=t.onSearch,c=Object(r.useState)(!1),s=Object(a.a)(c,2),o=s[0],l=s[1],j=Object(r.useCallback)((function(){return l(!1)}),[l]),h=function(t){return t===n},f=function(t){return h(t)?u:"transparent"},m=function(t){return h(t)?d:"inherit"};return Object(dt.jsx)("nav",{className:"Menu",children:Object(dt.jsx)("div",{className:vt()("flip-container",{active:o}),children:o?Object(dt.jsx)("div",{className:vt()("flip-back",{active:o}),children:Object(dt.jsx)(Ot,{onChange:i,onClose:j})}):Object(dt.jsxs)("ul",{style:{backgroundColor:d,color:b},className:vt()("flip-front",{active:!o}),children:[Object(dt.jsx)("li",{style:{backgroundColor:f(rt.All),color:m(rt.All)},children:Object(dt.jsx)("button",{"aria-label":st.allItemsListCTA,onClick:function(){return e(rt.All)},children:Object(dt.jsx)(ft.a,{})})}),Object(dt.jsx)("li",{style:{backgroundColor:f(rt.Required),color:m(rt.Required)},children:Object(dt.jsx)("button",{"aria-label":st.requiredListCTA,onClick:function(){return e(rt.Required)},children:Object(dt.jsx)(it.b,{})})}),Object(dt.jsx)("li",{style:{backgroundColor:f(rt.Mandatory),color:m(rt.Mandatory)},children:Object(dt.jsx)("button",{"aria-label":st.mandatoryListCTA,onClick:function(){return e(rt.Mandatory)},children:Object(dt.jsx)(it.c,{})})}),Object(dt.jsx)("li",{children:Object(dt.jsx)("button",{"aria-label":st.searchCTA,onClick:function(){return l(!0)},children:Object(dt.jsx)(it.d,{})})})]})})})};function gt(){var t=nt(),e=t.items,n=t.actions,i=Object(r.useState)(""),c=Object(a.a)(i,2),s=c[0],o=c[1],u=Object(r.useState)(rt.All),l=Object(a.a)(u,2),d=l[0],b=l[1];return Object(r.useEffect)((function(){n.getAllItems()}),[n,d]),Object(dt.jsxs)(dt.Fragment,{children:[d===rt.All&&Object(dt.jsx)(ht,{items:e.search(s).getAll()}),d===rt.Required&&Object(dt.jsx)(ht,{items:e.search(s).getAllRequired()}),d===rt.Mandatory&&Object(dt.jsx)(ht,{items:e.search(s).getAllMandatory()}),Object(dt.jsx)(pt,{activeView:d,setView:b,onSearch:o})]})}var xt=n(164);function It(){var t=Object(lt.d)("/items/:id"),e=Object(a.a)(t,2),n=e[0],r=e[1];return Object(dt.jsx)(xt.a,{in:n,timeout:500,children:Object(dt.jsxs)("div",{children:["Hi, this is: ",r.id]})})}function At(){var t=Object(lt.d)("/settings"),e=Object(a.a)(t,1)[0],n=nt(),i=n.settings,c=n.actions;return Object(r.useEffect)((function(){c.getSettings()}),[c]),Object(dt.jsx)(xt.a,{in:e,timeout:500,children:Object(dt.jsxs)("form",{onSubmit:function(t){var e;t.preventDefault();var n=null===(e=new FormData(t.currentTarget).get("syncUrl"))||void 0===e?void 0:e.toString();n&&n.length&&c.setSettings({syncUrl:n})},children:[Object(dt.jsx)("input",{name:"syncUrl",type:"text",defaultValue:i.syncUrl}),Object(dt.jsx)("button",{type:"submit",children:"\ud83d\udcbe"})]})})}var wt=function(){var t=Object(lt.d)("/"),e=Object(a.a)(t,1)[0];return Object(r.useEffect)((function(){et()}),[]),Object(dt.jsx)(lt.c,{base:"/ulist-mvp",children:Object(dt.jsxs)("div",{className:"App",children:[Object(dt.jsxs)("header",{className:"App-header",style:{backgroundColor:d,color:b},children:[Object(dt.jsx)("span",{children:!e&&Object(dt.jsx)(lt.a,{to:"/",children:"\ud83d\udd19"})}),Object(dt.jsx)("span",{children:"\ud83d\uded2 Groceries list \ud83d\uded2"}),Object(dt.jsx)("span",{children:Object(dt.jsx)(lt.a,{to:"/settings",children:"\u2699\ufe0f"})})]}),Object(dt.jsxs)("main",{className:"App-main",children:[Object(dt.jsx)(lt.b,{path:"/",component:gt}),Object(dt.jsx)(lt.b,{path:"/settings",component:At}),Object(dt.jsx)(lt.b,{path:"/items/:id",component:It})]})]})})},Rt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,166)).then((function(e){var n=e.getCLS,r=e.getFID,i=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),r(t),i(t),c(t),s(t)}))};s.a.createRoot(document.getElementById("root")).render(Object(dt.jsx)(i.a.StrictMode,{children:Object(dt.jsx)(wt,{})})),Rt()}},[[158,1,2]]]);
//# sourceMappingURL=main.f2abccbb.chunk.js.map